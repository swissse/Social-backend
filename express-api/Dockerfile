# Используем образ дистрибутив линукс Alpine с версией Node.js 19.
FROM node:19.5.0-alpine

# Указываем нашу рабочую директорию
WORKDIR /app

# Копируем package.json и файлы блокировки (yarn.lock или package-lock.json)
# Это позволяет использовать преимущества кэширования Docker.
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем остальную часть приложения в контейнер
COPY . .

# Генерируем клиент Prisma
# Важно делать это после копирования всех файлов, поскольку генерация
# может зависеть от вашей схемы Prisma и других файлов.
RUN npx prisma generate

# Открываем порт 3000 в нашем контейнере
EXPOSE 3000

# Запускаем сервер
CMD [ "npm", "start" ]